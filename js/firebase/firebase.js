firebase.initializeApp(firebaseConfig);const messaging=firebase.messaging();navigator.serviceWorker.register('/firebase-messaging-sw.js').then((registration)=>{messaging.useServiceWorker(registration);});messaging.requestPermission().then(function(){console.log('Have Permission');return messaging.getToken();}).then(function(token){console.log('received token',token);subscribeTokenToTopic(token);}).catch(function(err){console.log(err);console.log('Error Occured');});messaging.onMessage(function(payload){console.log("Message received. ",payload);const notificationTitle=payload.data.title;const notificationOptions={body:payload.data.body,icon:payload.data.icon};var notification=new Notification(notificationTitle,notificationOptions);notification.onclick=function(){window.open(payload.data.url);}});function subscribeTokenToTopic(token){var url='/firebase-register';const fhttp=new XMLHttpRequest();fhttp.onreadystatechange=function(){if(this.readyState==4&&this.status==200){console.log(fhttp.response);}};fhttp.open("POST",url,true);fhttp.setRequestHeader('Content-type','application/json');fhttp.send(JSON.stringify({token:token}));}